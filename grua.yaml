haveged:
  image: harbur/haveged:1.7c-1
  options:
    - "--privileged"
  before: 
    - alfresco
    - share
    - solr
tomcat:
  build: tomcat
  tag: marsbard/tomcat
  run: false
skydns:
  image: crosbymichael/skydns
  name: skydns
  ports:
    - "172.17.0.1:53:53/udp"
  command: "-nameserver 8.8.8.8:53 -domain docker"
  before: 
    - haveged
skydock:
  image: crosbymichael/skydock
  name: skydock
  volumes: 
    - /var/run/docker.sock:/docker.sock
  command: "-ttl 30 -environment ns -s /docker.sock -domain docker"
  after: 
    - skydns
  before:
    - alfresco
    - share
    - solr
alfresco:
  build: alfresco
  options:
    - "--expose=2021"
    - "--expose=7070"
    - "--expose=8080"
  ports:
    - "8081:8080"
  volumes: 
    - /data/alfresco/repo/data:/data
    - /data/alfresco/repo/logs:/logs
  dns: 172.17.0.1
  hostname: alfresco
share:
  build: share
  options:
    - "--expose=8080"
  ports:
    - "8080:8080"
  volumes: 
    - /data/alfresco/share:/data
  dns: 172.17.0.1
  hostname: share
  after:
    - alfresco
  before:
    - solr
solr:
  build: solr
  hostname: solr
  volumes:
    - /data/alfresco/solr/data:/data
    - /data/alfresco/solr/content:/content
    - /data/alfresco/solr/logs:/logs
  dns: 172.17.0.1
mysql:
  hostname: mysql
  image: "mysql:5.6"
  volumes: 
    - /data/alfresco/mysql:/var/lib/mysql
  environment:
    MYSQL_DATABASE: alfresco
    MYSQL_USER: alfresco
    MYSQL_PASSWORD: alfresco
    MYSQL_ROOT_PASSWORD: alfresco
  dns: 172.17.0.1
  before:
    - alfresco
postfix:
  hostname: postfix
  image: "catatnight/postfix"
  ports:
    - "25:25"
  environment: 
    maildomain: "alfresco.local"
    smtp_user: "mailuser:password"
  dns: 172.17.0.1
