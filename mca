#!/bin/bash

cd "`dirname $0`"

set -e

ROOT="etc-mca"

dirs=`ls -F $ROOT | grep /`


if [ "$1" = "" ]
then
	echo
	echo "        mca - Multi Container Alfresco"
	echo "        ------------------------------"
	echo 
	echo The following commands are available:
	echo
	for dir in $dirs
	do
		echo  "mca `cat $ROOT/$dir/CMD` - `cat $ROOT/$dir/INFO`"
	done
	echo
	echo "For more help on a command you may try 'mca help <command>'"
	echo
elif [ "$1" == "edit" ]
then
  for adir in $dirs
	do
		if [ -f $ROOT/$dir/CMD -a "$(cat $ROOT/$dir/CMD)" == $2 ]
		then
			echo \$1=$1 \$2=$2 \$3=$3
			dir=$(echo $adir )
			if [ -n $3 ]
			then
				${EDITOR:-vi} $ROOT/$dir/$3
			else
	    	${EDITOR:-vi} $ROOT/$dir/*
			fi
		fi
	done
elif [ "$1" == "help" ]
then
	if [ -z "$2" ]
	then
    $0
	else
		for dir in $dirs
		do
			if [ -f $ROOT/$dir/CMD -a "$(cat $ROOT/$dir/CMD)" == $2 ]
			then
				echo
				echo "mca $(cat $ROOT/$dir/CMD)"
				echo
				cat $ROOT/$dir/HELP
				echo
			fi
		done
	fi
else
  # search for the command 
	for dir in $dirs
	do
    if [ -f $ROOT/$dir/CMD ]
		then
			if [ "$( cat $ROOT/$dir/CMD )" == "$1" ]
			then
				shift
				echo -e "--==] \t mca `cat $ROOT/$dir/CMD` \t [==--"
				echo
				bash $ROOT/$dir/do.sh $*
			fi
		fi
	done
fi
